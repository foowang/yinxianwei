<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS6新特征：UIRefreshControl[下拉刷新]使用示例 | 一枝红杏出墙来</title>
  <meta name="author" content="尹现伟">
  
  <meta name="description" content="原文出处:http://www.devdiv.com/iOSiPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="iOS6新特征：UIRefreshControl[下拉刷新]使用示例"/>
  <meta property="og:site_name" content="一枝红杏出墙来"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="一枝红杏出墙来" type="application/atom+xml">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
  

</head>


<body>
  <header id="header" class="inner"><div id="nav-top">
  <div class="alignleft main-title">
    <h1>一枝红杏出墙来</h1>
    <h2></h2>
  </div>
  <nav id="main-nav" class="alignright">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
      
        <div class="icon"></div>
        <time datetime="2014-05-04T12:44:00.000Z"><a href="/2014/05/04/iOS6新特征：UIRefreshControl[下拉刷新]使用示例/">5月 4 2014</a></time>
      
      
  
    <h1 class="title">iOS6新特征：UIRefreshControl[下拉刷新]使用示例</h1>
  

      
    </header>
    <div class="entry">
      
        
          
        
        <p>原文出处:<a href="http://www.devdiv.com/iOS_iPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl_%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-thread-127741-1-1.html" target="_blank" rel="external">http://www.devdiv.com/iOS<em>iPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl</em>%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-thread-127741-1-1.html</a><br>注：这里是iOS6新特征汇总贴链接 <a href="http://www.devdiv.com/iOS_iPhone-ios_-thread-127965-1-1.html" target="_blank" rel="external">iOS6新特征：参考资料和示例汇总</a></p>
<p>小弟不才，今天研究了一下iOS6中的一个新控件UIRefreshControl，下面与大家分享一下。</p>
<p>不会模仿的公司不是好公司不会剽窃的公司不是优秀公司<br>不会调戏代码的不是骨灰级码工<br>你同意吗？<br>苹果估计想取代第三方的pull to refresh】</p>
<p>下面是效果图，这里是代码示例 <img src="http://www.devdiv.com/static/image/filetype/zip.gif" alt=""><a href="http://www.devdiv.com/forum.php?mod=misc&amp;action=attachpay&amp;aid=32936&amp;tid=127741" target="_blank" rel="external">DevDiv_UIRefreshControl.zip</a> (144.42<br> KB, 下载次数: 1042, 售价: 1 资源分) </p>
<p><img src="http://www.devdiv.com/forum.php?mod=attachment&amp;aid=MzI5Mzd8Mzk1NmY0NjZ8MTM5OTIwNzU1NnwwfDEyNzc0MQ%3D%3D&amp;noupdate=yes" alt="QQ20120615-2.png" title="QQ20120615-2.png"></p>
<p>下面大致介绍一下UIRefreshControl的使用</p>
<p>1、使用范围<br>如果你装了xcode_4.5_developer_preview，那么在UITableViewController.h文件中你会看到，UITableViewController里面有如下声明，说明UITableViewController已经内置了UIRefreshControl控件</p>
<p><code>1``@property
 (nonatomic,retain) UIRefreshControl *refreshControl NS_AVAILABLE_IOS(6_0);</code></p>
<p>【注】：UIRefreshControl目前只能用于UITableViewController，如果用在其他ViewController中，运行时会得到如下错误提示：（即UIRefreshControl只能被UITableViewController管理）</p>
<p><code>1``2012-06-15
 14:34:34.908 DevDivUIRefreshControl[722:10103] *** Terminating app due to uncaught exception ``&#39;NSInternalInconsistencyException&#39;``,
 reason: ``&#39;UIRefreshControl
 may only be managed by a UITableViewController&#39;``2``***
 First ``throw</code> <code>call
 stack:``3``(0x186fd72
 0x1066e51 0x186fb4b 0x55a559 0x57238 0x5d482 0x55ad2 0x2ebb 0xeb2a3 0xeb30e 0x10b7e9 0x10b624 0x109aef 0x10999c 0x107adc 0x1082c6 0xecf24 0xed1e0 0xee084 0x5645c 0x5cf31 0x55ad2 0x4131d 0x414f6 0x4168c 0x49871 0x10a90 0x1196a 0x222be 0x22f9f 0x153fd 0x17ccf39
 0x17ccc10 0x17e5da5 0x17e5b12 0x1816b46 0x1815ed4 0x1815dab 0x1128f 0x12e71 0x29fd 0x2925)``4``libc++abi.dylib:
 terminate called throwing an exception``5``(lldb)</code></p>
<p>2、如何使用<br>    a)初始化<br>如何在UITableViewController 中使用UIRefreshControl呢，在上面给出的代码附件中，你可以很详细的知道，这里介绍一下关键的部分：</p>
<p><code>1``   ``self.refreshControl
 = [[UIRefreshControl alloc]init];``2``    ``// 
   self.refreshControl.tintColor = [UIColor blueColor];``3``    ``self.refreshControl.attributedTitle
 = [[NSAttributedString alloc]initWithString:@``&quot;下拉刷新&quot;``];``4``    ``[self.refreshControl
 addTarget:self action:@selector(RefreshViewControlEventValueChanged) forControlEvents:UIControlEventValueChanged];</code></p>
<p>如上面看到的代码，虽然UITableViewController已经声明了UIRefreshControl，但是貌似还没有初始化，所以需要我们自己初始化。很神奇，初始化的时候并不需要给它指定frame，UITableViewController会为我们进行管理。遗憾的时目前只看到下拉刷新功能，上拉刷新还没有，估计在最终版里面苹果会考虑加入上拉刷新功能。<br>我们还可以给UIRefreshControl设置tintColor和attributedTitle。</p>
<pre><code>b)下拉刷新事件监听
</code></pre><p>当用户进行下拉刷新操作时，UIRefreshControl 会触发一个UIControlEventValueChanged事件，通过监听这个事件，我们就可以进行类似数据请求的操作了。如下代码：</p>
<p><code>1``[self.refreshControl
 addTarget:self action:@selector(RefreshViewControlEventValueChanged)</code></p>
<pre><code><span class="built_in">c</span>)进行数据请求
</code></pre><p>在示例中，为了演示数据请求，我简单的做了一个延时处理，2秒钟后，调用handleData</p>
<p><code>1``[self
 performSelector:@selector(handleData) withObject:nil afterDelay:2];</code></p>
<p>在handleData里面，就表示已经请求到了数据，在此进行UI更新即可。也需要注意的是，我们调用UIRefreshControl 的endRefreshing方法，表示刷新结束，让UIRefreshControl更新显示。</p>
<p><code>1``-
 (``void``)
 handleData``2``{``3``    ``NSLog(@``&quot;refreshed&quot;``);``4``    ``[self.refreshControl
 endRefreshing];``5``    ``self.refreshControl.attributedTitle
 = [[NSAttributedString alloc]initWithString:@``&quot;下拉刷新&quot;``];``6</code> <code>7``    ``self.count++;``8``    ``[self.tableView
 reloadData];``9``}</code></p>
<p>3、官方头文件<br>下面是sdk中UIRefreshControl的声明，想必看了下面的代码，你已经知道如何使用了。<br><a href="http://www.devdiv.com/#viewSource" title="view source" target="_blank" rel="external">view<br> source</a><a href="http://www.devdiv.com/#printSource" title="print" target="_blank" rel="external">print</a><a href="http://www.devdiv.com/#about" title="?" target="_blank" rel="external">?</a><code>01``//``02``//  UIRefreshControl.h``03``//  UIKit``04``//``05``//  Copyright
 2012 Apple Inc. All rights reserved.``06``//``07</code> <code>08``#import
 &lt;Foundation/Foundation.h&gt;``09``#import
 &lt;UIKit/UIControl.h&gt;``10``#import
 &lt;UIKit/UIKitDefines.h&gt;``11</code> <code>12``NS_CLASS_AVAILABLE_IOS(6_0)
 @interface UIRefreshControl : UIControl``13</code> <code>14``/*
 The designated initializer``15`` ``*
 This initializes a UIRefreshControl with a default height and width.``16`` ``*
 Once assigned to a UITableViewController, the frame of the control is managed automatically.``17`` ``*
 When a user has pulled-to-refresh, the UIRefreshControl fires its UIControlEventValueChanged event.``18`` ``*/``19``-
 (id)init;``20</code> <code>21``@property
 (nonatomic, readonly, getter=isRefreshing) ``BOOL</code> <code>refreshing;``22</code> <code>23``@property
 (nonatomic, retain) UIColor *tintColor UI_APPEARANCE_SELECTOR;``24``@property
 (nonatomic, retain) NSAttributedString *attributedTitle UI_APPEARANCE_SELECTOR;``25</code> <code>26``//
 May be used to indicate to the refreshControl that an external event has initiated the refresh action``27``-
 (``void``)beginRefreshing
 NS_AVAILABLE_IOS(6_0);``28``//
 Must be explicitly called when the refreshing has completed``29``-
 (``void``)endRefreshing
 NS_AVAILABLE_IOS(6_0);``30</code> `31``@end</p>
<p>`</p>

      
    </div>
    <footer>
      
  
  <div class="categories">
    <a href="/categories/iOS应用开发之UI/">iOS应用开发之UI</a>
  </div>

      
  
  <div class="tags">
    <a href="/tags/UITableViewControlle/">UITableViewControlle</a>
  </div>

      
        <div class="alignright share-box">
  
</div>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  
    <form>
      <input id="st-search-input" type="search" placeholder="Search">
    </form>
    <div id="st-results-container"></div>
  
</div>

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <div class="entry">
    
      <span><a href="/tags/2d/">2d<small>1</small></a></span>
    
      <span><a href="/tags/AFNetworking/">AFNetworking<small>2</small></a></span>
    
      <span><a href="/tags/CoreData/">CoreData<small>2</small></a></span>
    
      <span><a href="/tags/Drawing/">Drawing<small>1</small></a></span>
    
      <span><a href="/tags/MagicalRecord/">MagicalRecord<small>1</small></a></span>
    
      <span><a href="/tags/NSDate/">NSDate<small>1</small></a></span>
    
      <span><a href="/tags/NSString/">NSString<small>1</small></a></span>
    
      <span><a href="/tags/Swift/">Swift<small>9</small></a></span>
    
      <span><a href="/tags/UIAlertView/">UIAlertView<small>1</small></a></span>
    
      <span><a href="/tags/UITabBarController/">UITabBarController<small>1</small></a></span>
    
      <span><a href="/tags/UITableViewControlle/">UITableViewControlle<small>1</small></a></span>
    
      <span><a href="/tags/UIWebView/">UIWebView<small>1</small></a></span>
    
      <span><a href="/tags/URL-Scheme/">URL Scheme<small>1</small></a></span>
    
      <span><a href="/tags/URL编码/">URL编码<small>1</small></a></span>
    
      <span><a href="/tags/XMPP/">XMPP<small>3</small></a></span>
    
      <span><a href="/tags/Xcode5-1/">Xcode5.1<small>1</small></a></span>
    
      <span><a href="/tags/api/">api<small>5</small></a></span>
    
      <span><a href="/tags/appStore审核/">appStore审核<small>1</small></a></span>
    
      <span><a href="/tags/block/">block<small>1</small></a></span>
    
      <span><a href="/tags/bytearray/">bytearray<small>1</small></a></span>
    
      <span><a href="/tags/cell自适应高度/">cell自适应高度<small>1</small></a></span>
    
      <span><a href="/tags/cocos2d/">cocos2d<small>3</small></a></span>
    
      <span><a href="/tags/fontfontiPhone开发font/">fontfontiPhone开发font<small>1</small></a></span>
    
      <span><a href="/tags/fontfontiPhone开发fontfont/">fontfontiPhone开发fontfont<small>1</small></a></span>
    
      <span><a href="/tags/fontfontios的fontfont/">fontfontios的fontfont<small>2</small></a></span>
    
      <span><a href="/tags/fontfont动画fontfont/">fontfont动画fontfont<small>1</small></a></span>
    
      <span><a href="/tags/framework/">framework<small>1</small></a></span>
    
      <span><a href="/tags/iOS8/">iOS8<small>2</small></a></span>
    
      <span><a href="/tags/iOS8-1-1/">iOS8.1.1<small>1</small></a></span>
    
      <span><a href="/tags/iOS8定位/">iOS8定位<small>1</small></a></span>
    
      <span><a href="/tags/iOS国际化/">iOS国际化<small>1</small></a></span>
    
      <span><a href="/tags/iOS应用开发之app上架/">iOS应用开发之app上架<small>1</small></a></span>
    
      <span><a href="/tags/iOS应用开发之第三方框架/">iOS应用开发之第三方框架<small>1</small></a></span>
    
      <span><a href="/tags/iOS开发/">iOS开发<small>5</small></a></span>
    
      <span><a href="/tags/iOS自定义Tabbar/">iOS自定义Tabbar<small>1</small></a></span>
    
      <span><a href="/tags/ios/">ios<small>53</small></a></span>
    
      <span><a href="/tags/ios7/">ios7<small>1</small></a></span>
    
      <span><a href="/tags/ios7适配/">ios7适配<small>1</small></a></span>
    
      <span><a href="/tags/ios国际化/">ios国际化<small>1</small></a></span>
    
      <span><a href="/tags/ios开发/">ios开发<small>27</small></a></span>
    
      <span><a href="/tags/iphone/">iphone<small>4</small></a></span>
    
      <span><a href="/tags/iphone开发/">iphone开发<small>59</small></a></span>
    
      <span><a href="/tags/itunes/">itunes<small>1</small></a></span>
    
      <span><a href="/tags/objective-c/">objective-c<small>1</small></a></span>
    
      <span><a href="/tags/svn/">svn<small>1</small></a></span>
    
      <span><a href="/tags/uiimage/">uiimage<small>2</small></a></span>
    
      <span><a href="/tags/uitableview/">uitableview<small>1</small></a></span>
    
      <span><a href="/tags/uitableviewcell/">uitableviewcell<small>1</small></a></span>
    
      <span><a href="/tags/uitextfield/">uitextfield<small>1</small></a></span>
    
      <span><a href="/tags/uiview/">uiview<small>3</small></a></span>
    
      <span><a href="/tags/uiviewcontroller/">uiviewcontroller<small>1</small></a></span>
    
      <span><a href="/tags/uiwebview/">uiwebview<small>1</small></a></span>
    
      <span><a href="/tags/xcode/">xcode<small>2</small></a></span>
    
      <span><a href="/tags/xmpp/">xmpp<small>1</small></a></span>
    
      <span><a href="/tags/二维码/">二维码<small>1</small></a></span>
    
      <span><a href="/tags/企业/">企业<small>1</small></a></span>
    
      <span><a href="/tags/动画/">动画<small>5</small></a></span>
    
      <span><a href="/tags/国际化/">国际化<small>1</small></a></span>
    
      <span><a href="/tags/在线工具/">在线工具<small>1</small></a></span>
    
      <span><a href="/tags/多线程/">多线程<small>1</small></a></span>
    
      <span><a href="/tags/存储/">存储<small>1</small></a></span>
    
      <span><a href="/tags/宏/">宏<small>1</small></a></span>
    
      <span><a href="/tags/导航/">导航<small>1</small></a></span>
    
      <span><a href="/tags/屏幕旋转/">屏幕旋转<small>2</small></a></span>
    
      <span><a href="/tags/应用程序/">应用程序<small>2</small></a></span>
    
      <span><a href="/tags/微信开放平台ios/">微信开放平台ios<small>1</small></a></span>
    
      <span><a href="/tags/打开AppStore/">打开AppStore<small>1</small></a></span>
    
      <span><a href="/tags/数据库/">数据库<small>1</small></a></span>
    
      <span><a href="/tags/缓存/">缓存<small>1</small></a></span>
    
      <span><a href="/tags/聊天/">聊天<small>1</small></a></span>
    
      <span><a href="/tags/苹果应用商店/">苹果应用商店<small>1</small></a></span>
    
      <span><a href="/tags/获取iP地址/">获取iP地址<small>1</small></a></span>
    
  </div>
</div>




  <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

    _st('install','6xH6jcZvsZxn2a9rcU4t');
  </script>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div id="foot-nav">
  <ul class="social">
    
      <li><a class="github" href="https://github.com/DaiXiang" title="github">github</a></li>
    
      <li><a class="rss" href="/atom.xml" title="rss">rss</a></li>
    
  </ul>
</div>
<div>
  
    &copy; 2014 尹现伟
  
</div>
<div class="clearfix"></div></footer>
  


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<script type="text/javascript">
  function navbar() {
    var top = $('#nav-top').innerHeight();
    $('#header').css('min-height', top);
  }
  navbar();
  $(window).resize(navbar);
</script>
<div id="totop" class="footer-btn">
  <a title="Return to Top"><img src="/img/scrollup.png"/></a>
</div>

<script type="text/javascript">
  $(function(){ 
	// When to show the scroll link
	// higher number = scroll link appears further down the page   
	var upperLimit = 800;
	
	// Our scroll link element
	var scrollElem = $('#totop');
   
	// Scroll to top speed
	var scrollSpeed = 500;
   
	// Show and hide the scroll to top link based on scroll position   
	scrollElem.hide();
	$(window).scroll(function () {            
		var scrollTop = $(document).scrollTop();       
		if ( scrollTop > upperLimit ) {
		  $(scrollElem).stop().fadeTo(300, 1); // fade back in
		  $(scrollElem).animate({bottom: "50px"}, { queue: false, duration: 10 });
		} else {
		  $(scrollElem).stop().fadeTo(300, 0); // fade out
	      $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
			
		}
	});

	// Scroll to top animation on click
	$(scrollElem).click(function(){
	  $('html, body').animate({scrollTop:0}, scrollSpeed);
	  $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
	  return false;
	});
  });
</script>
</body>
</html>