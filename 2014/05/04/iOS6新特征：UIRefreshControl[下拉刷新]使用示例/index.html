
 <!DOCTYPE HTML>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8" />
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88" />
  
    <title>iOS6新特征：UIRefreshControl[下拉刷新]使用示例 | 一枝红杏出墙来</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="尹现伟">
    
    <meta name="description" content="原文出处:http://www.devdiv.com/iOSiPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E">
    
    
    
    
    <link rel="alternate" href="atom.xml" title="一枝红杏出墙来" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='3Fe2f16542da9a28b88ba4dfee8859f1c9';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="一枝红杏出墙来">一枝红杏出墙来</a></h1>
				<a class="blog-motto"></a>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
					<li>
					
                                            <form class="search" action=http://zhannei.baidu.com/cse/search target="_blank">
                                            <label>Search</label>
                                        <input name="s" type="hidden" value= 5245445321399961340 ><input type="text" name="q" size="60" placeholder="搜索"><br>
					
					</li>
				</ul>
                            </nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/05/04/iOS6新特征：UIRefreshControl[下拉刷新]使用示例/" title="iOS6新特征：UIRefreshControl[下拉刷新]使用示例" itemprop="url">iOS6新特征：UIRefreshControl[下拉刷新]使用示例</a>
  </h1>
  <p class="article-author">By
    
      <a href="/about" title="尹现伟">尹现伟</a>
    </p>
  <p class="article-time">
    <time datetime="2014-05-04T12:44:00.000Z" itemprop="datePublished">5月 4 2014</time>
    更新日期:<time datetime="2014-10-30T10:47:16.000Z" itemprop="dateModified">10月 30 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
		</div>
		
		<p>原文出处:<a href="http://www.devdiv.com/iOS_iPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl_%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-thread-127741-1-1.html" target="_blank" rel="external">http://www.devdiv.com/iOS<em>iPhone-iOS6%E6%96%B0%E7%89%B9%E5%BE%81%EF%BC%9AUIRefreshControl</em>%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-thread-127741-1-1.html</a><br>注：这里是iOS6新特征汇总贴链接 <a href="http://www.devdiv.com/iOS_iPhone-ios_-thread-127965-1-1.html" target="_blank" rel="external">iOS6新特征：参考资料和示例汇总</a></p>
<p>小弟不才，今天研究了一下iOS6中的一个新控件UIRefreshControl，下面与大家分享一下。</p>
<p>不会模仿的公司不是好公司不会剽窃的公司不是优秀公司<br>不会调戏代码的不是骨灰级码工<br>你同意吗？<br>苹果估计想取代第三方的pull to refresh】</p>
<p>下面是效果图，这里是代码示例 <img src="http://www.devdiv.com/static/image/filetype/zip.gif" alt=""><a href="http://www.devdiv.com/forum.php?mod=misc&amp;action=attachpay&amp;aid=32936&amp;tid=127741" target="_blank" rel="external">DevDiv_UIRefreshControl.zip</a> (144.42<br> KB, 下载次数: 1042, 售价: 1 资源分) </p>
<p><img src="http://www.devdiv.com/forum.php?mod=attachment&amp;aid=MzI5Mzd8Mzk1NmY0NjZ8MTM5OTIwNzU1NnwwfDEyNzc0MQ%3D%3D&amp;noupdate=yes" alt="QQ20120615-2.png" title="QQ20120615-2.png"></p>
<p>下面大致介绍一下UIRefreshControl的使用</p>
<p>1、使用范围<br>如果你装了xcode_4.5_developer_preview，那么在UITableViewController.h文件中你会看到，UITableViewController里面有如下声明，说明UITableViewController已经内置了UIRefreshControl控件</p>
<p><code>1``@property
 (nonatomic,retain) UIRefreshControl *refreshControl NS_AVAILABLE_IOS(6_0);</code></p>
<p>【注】：UIRefreshControl目前只能用于UITableViewController，如果用在其他ViewController中，运行时会得到如下错误提示：（即UIRefreshControl只能被UITableViewController管理）</p>
<p><code>1``2012-06-15
 14:34:34.908 DevDivUIRefreshControl[722:10103] *** Terminating app due to uncaught exception ``&#39;NSInternalInconsistencyException&#39;``,
 reason: ``&#39;UIRefreshControl
 may only be managed by a UITableViewController&#39;``2``***
 First ``throw</code> <code>call
 stack:``3``(0x186fd72
 0x1066e51 0x186fb4b 0x55a559 0x57238 0x5d482 0x55ad2 0x2ebb 0xeb2a3 0xeb30e 0x10b7e9 0x10b624 0x109aef 0x10999c 0x107adc 0x1082c6 0xecf24 0xed1e0 0xee084 0x5645c 0x5cf31 0x55ad2 0x4131d 0x414f6 0x4168c 0x49871 0x10a90 0x1196a 0x222be 0x22f9f 0x153fd 0x17ccf39
 0x17ccc10 0x17e5da5 0x17e5b12 0x1816b46 0x1815ed4 0x1815dab 0x1128f 0x12e71 0x29fd 0x2925)``4``libc++abi.dylib:
 terminate called throwing an exception``5``(lldb)</code></p>
<p>2、如何使用<br>    a)初始化<br>如何在UITableViewController 中使用UIRefreshControl呢，在上面给出的代码附件中，你可以很详细的知道，这里介绍一下关键的部分：</p>
<p><code>1``   ``self.refreshControl
 = [[UIRefreshControl alloc]init];``2``    ``// 
   self.refreshControl.tintColor = [UIColor blueColor];``3``    ``self.refreshControl.attributedTitle
 = [[NSAttributedString alloc]initWithString:@``&quot;下拉刷新&quot;``];``4``    ``[self.refreshControl
 addTarget:self action:@selector(RefreshViewControlEventValueChanged) forControlEvents:UIControlEventValueChanged];</code></p>
<p>如上面看到的代码，虽然UITableViewController已经声明了UIRefreshControl，但是貌似还没有初始化，所以需要我们自己初始化。很神奇，初始化的时候并不需要给它指定frame，UITableViewController会为我们进行管理。遗憾的时目前只看到下拉刷新功能，上拉刷新还没有，估计在最终版里面苹果会考虑加入上拉刷新功能。<br>我们还可以给UIRefreshControl设置tintColor和attributedTitle。</p>
<pre><code>b)下拉刷新事件监听
</code></pre><p>当用户进行下拉刷新操作时，UIRefreshControl 会触发一个UIControlEventValueChanged事件，通过监听这个事件，我们就可以进行类似数据请求的操作了。如下代码：</p>
<p><code>1``[self.refreshControl
 addTarget:self action:@selector(RefreshViewControlEventValueChanged)</code></p>
<pre><code><span class="built_in">c</span>)进行数据请求
</code></pre><p>在示例中，为了演示数据请求，我简单的做了一个延时处理，2秒钟后，调用handleData</p>
<p><code>1``[self
 performSelector:@selector(handleData) withObject:nil afterDelay:2];</code></p>
<p>在handleData里面，就表示已经请求到了数据，在此进行UI更新即可。也需要注意的是，我们调用UIRefreshControl 的endRefreshing方法，表示刷新结束，让UIRefreshControl更新显示。</p>
<p><code>1``-
 (``void``)
 handleData``2``{``3``    ``NSLog(@``&quot;refreshed&quot;``);``4``    ``[self.refreshControl
 endRefreshing];``5``    ``self.refreshControl.attributedTitle
 = [[NSAttributedString alloc]initWithString:@``&quot;下拉刷新&quot;``];``6</code> <code>7``    ``self.count++;``8``    ``[self.tableView
 reloadData];``9``}</code></p>
<p>3、官方头文件<br>下面是sdk中UIRefreshControl的声明，想必看了下面的代码，你已经知道如何使用了。<br><a href="http://www.devdiv.com/#viewSource" title="view source" target="_blank" rel="external">view<br> source</a><a href="http://www.devdiv.com/#printSource" title="print" target="_blank" rel="external">print</a><a href="http://www.devdiv.com/#about" title="?" target="_blank" rel="external">?</a><code>01``//``02``//  UIRefreshControl.h``03``//  UIKit``04``//``05``//  Copyright
 2012 Apple Inc. All rights reserved.``06``//``07</code> <code>08``#import
 &lt;Foundation/Foundation.h&gt;``09``#import
 &lt;UIKit/UIControl.h&gt;``10``#import
 &lt;UIKit/UIKitDefines.h&gt;``11</code> <code>12``NS_CLASS_AVAILABLE_IOS(6_0)
 @interface UIRefreshControl : UIControl``13</code> <code>14``/*
 The designated initializer``15`` ``*
 This initializes a UIRefreshControl with a default height and width.``16`` ``*
 Once assigned to a UITableViewController, the frame of the control is managed automatically.``17`` ``*
 When a user has pulled-to-refresh, the UIRefreshControl fires its UIControlEventValueChanged event.``18`` ``*/``19``-
 (id)init;``20</code> <code>21``@property
 (nonatomic, readonly, getter=isRefreshing) ``BOOL</code> <code>refreshing;``22</code> <code>23``@property
 (nonatomic, retain) UIColor *tintColor UI_APPEARANCE_SELECTOR;``24``@property
 (nonatomic, retain) NSAttributedString *attributedTitle UI_APPEARANCE_SELECTOR;``25</code> <code>26``//
 May be used to indicate to the refreshControl that an external event has initiated the refresh action``27``-
 (``void``)beginRefreshing
 NS_AVAILABLE_IOS(6_0);``28``//
 Must be explicitly called when the refreshing has completed``29``-
 (``void``)endRefreshing
 NS_AVAILABLE_IOS(6_0);``30</code> `31``@end</p>
<p>`</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/UITableViewControlle/">UITableViewControlle</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS应用开发之UI/">iOS应用开发之UI</a>
</div>



<div class="article-share" id="share">

  <div data-url="/about/2014/05/04/iOS6新特征：UIRefreshControl[下拉刷新]使用示例/" data-title="iOS6新特征：UIRefreshControl[下拉刷新]使用示例 | 一枝红杏出墙来" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/06/04/UITableView&UITableViewCell/" title="UITableView&amp;UITableViewCell">
  <strong>PREVIOUS:</strong><br/>
  <span>
  UITableView&amp;UITableViewCell</span>
</a>
</div>


<div class="next">
<a href="/2014/04/30/IOS开发～web在线安装App/"  title="IOS开发～web在线安装App">
 <strong>NEXT:</strong><br/> 
 <span>IOS开发～web在线安装App
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list" class="clearfix">
		
		
		
		
		
	</div>
</div>

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
      <li><a href="http://gengbiao.me" target="_blank" title="coney">coney's Blog</a></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
    
            <p class="copyright"> © 2014 
		
		<a href="/about" target="_blank" title="尹现伟">尹现伟</a>
		
            && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney">coney</a>
            </div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"yinxianwei"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





<script>
    
        var _bdImg = '4';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"分享：",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>





<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  </body>
</html>

