<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 14 | 一枝红杏出墙来</title>
  <meta name="author" content="尹现伟">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="一枝红杏出墙来"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="一枝红杏出墙来" type="application/atom+xml">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
  

</head>


<body>
  <header id="header" class="inner"><div id="nav-top">
  <div class="alignleft main-title">
    <h1>一枝红杏出墙来</h1>
    <h2></h2>
  </div>
  <nav id="main-nav" class="alignright">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
      
        <div class="icon"></div>
        <time datetime="2013-09-02T00:54:00.000Z"><a href="/2013/09/02/上传下载和文件操作/">9月 2 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/09/02/上传下载和文件操作/">上传下载和文件操作</a></h1>
  

      
    </header>
    <div class="entry">
      
        
        <p>POST上传</p>
<pre><code><span class="comment">//1.生成url   后面不跟参数</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSURL *url = [NSURL URLWithString:@"http://127.0.0.1:8080/UD/u?command=1"];</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//2.生成可变的请求</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//3.超时事件 </span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[request setTimeoutInterval:20];</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//4.POST请求</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[request setHTTPMethod:@"POST"];</div></pre></td></tr></table></figure>

<pre><code>//<span class="number">5.</span>设置Content-Type 在服务器可获得<span class="command"><span class="keyword">command</span></span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[request addValue:@"multipart/form-data" forHTTPHeaderField:@"Content-Type"];</div></pre></td></tr></table></figure>

<pre><code>//<span class="number">5.1</span>用沙盒目录下工程资源路径获得<span class="typedef"><span class="keyword">data</span></span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//    NSString *path = [[NSBundle mainBundle] pathForResource:@"2" ofType:@"jpg"];</div><div class="line">//    NSData *data = [NSData dataWithContentsOfFile:path];</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//6.获取工程的image</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    UIImage *image = [UIImage imageNamed:@"2.jpg"];</div><div class="line">//    UIImagePNGRepresentation(<#uiimage *image#="">);</#uiimage></div><div class="line">    //7.将image以JPEG格式压缩为data</div><div class="line">    NSData *data = UIImageJPEGRepresentation(image, 0.5);</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//8.将数据添加至请求</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[request setHTTPBody:data];</div></pre></td></tr></table></figure>

<pre><code>//<span class="number">8.1</span>将<span class="typedef"><span class="keyword">data</span>追加在请求数据中</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//    NSInputStream *inputStream = [[NSInputStream alloc] initWithFileAtPath:path];</div><div class="line">//    [request setHTTPBodyStream:inputStream];</div></pre></td></tr></table></figure>

<pre><code><span class="comment">//9.发起请求,上传文件</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[NSURLConnection connectionWithRequest:request delegate:self];</div></pre></td></tr></table></figure>

<p>服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">String command = request.getParameter("command");</div><div class="line">        System.out.println("-----------" + command);</div><div class="line"></div><div class="line">        //获得当前数据的长度（其实就是图片数据的大小）</div><div class="line">         int length = request.getContentLength();</div><div class="line">        //创建一个字节数组，用来存放接收到的图片数据</div><div class="line">         byte []buffer = new byte[length];</div><div class="line"></div><div class="line">        //获得servlet的输入流（输入通道）</div><div class="line">        ServletInputStream input = request.getInputStream();</div><div class="line"></div><div class="line"></div><div class="line">        for(int i=0; i<length; i++)<="" div=""><div class="line">        {</div><div class="line">            //从输入通道中读取数据，每次读一个字节</div><div class="line">            buffer[i] = (byte) input.read();</div><div class="line">        }</div><div class="line"></div><div class="line">        //FileInputStream  文件的输入流是读取牟高峰路径下的文件信息的</div><div class="line"></div><div class="line">        //创建一个文件的输出流，把内存中的数据写到本地</div><div class="line">        FileOutputStream output = new FileOutputStream("/Users/wxg/Desktop/test.jpg");</div><div class="line">        output.write(buffer);</div><div class="line">        //写完之后要关闭输出流</div><div class="line">        output.close();</div><div class="line"></div><div class="line">        out.println("文件上传成功");</div></length;></div></pre></td></tr></table></figure>

<p>下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">//获得沙盒目录Documents文件路径  返回添加文件夹路径</div><div class="line">-(NSString *)getFilePathWith:(NSString *)aPath</div><div class="line">{</div><div class="line">    return [NSHomeDirectory() stringByAppendingPathComponent:[NSString stringWithFormat:@"Documents/%@", aPath]];</div><div class="line">}</div><div class="line">- (void)viewDidLoad {</div><div class="line">    [super viewDidLoad];</div><div class="line">//1.文件管理器创建</div><div class="line">    NSFileManager *manager = [NSFileManager defaultManager];</div><div class="line">    //2.判断路径下是否有该文件夹</div><div class="line">    if (![manager fileExistsAtPath:[self getFilePathWith:@"Download"]])</div><div class="line">        {</div><div class="line">        //2.1创建文件夹</div><div class="line">        //        路径  过渡目录  描述信息  错误信息</div><div class="line">        [manager createDirectoryAtPath:[self getFilePathWith:@"Download"] withIntermediateDirectories:YES attributes:nil error:nil];</div><div class="line">    }</div><div class="line">    //3.生成文件目录</div><div class="line">    NSString *path = [self getFilePathWith:@"Download/test.dmg"];</div><div class="line">    //4.判断路径下是否有该文件</div><div class="line">    if (![manager fileExistsAtPath:path]) {</div><div class="line">        //4.1创建文件</div><div class="line">//        创建一个文件  文件路径  内容  描述信息</div><div class="line">        [manager createFileAtPath:path contents:nil attributes:nil];</div><div class="line">    }</div><div class="line">    //5.</div><div class="line">    _handel = [[NSFileHandle fileHandleForWritingAtPath:path] retain];</div><div class="line">}</div></pre></td></tr></table></figure>

<p>xcode 文件操作</p>
<p>对文件的操作是一项很基本的人际交互过程，这里简单总结一下常用的文件操作内容<br>1.沙盒的概念<br>沙盒是iPhone开发中的一个特有的概念，指的是程序运行时的存储空间范围。<br>出于对安全的考虑，苹果把iPhone中运行的程序限定在一个文件夹内，用户的任何操作都只能在这个文件夹内完成，绝不允许用户访问这个文件夹外的任何文件夹，这个限定文件夹就是“沙盒”。<br>可以这样理解，你的程序就像被关在一个装满沙子的盒子里面，无论你的程序怎么折腾，也不过是在沙子上留下点痕迹而已，就算出了再大的问题，用手一抹就恢复原状了。</p>
<p>2.获取路径<br>沙盒中默认有三个目录Documents、Library和tmp。而我们通常把文件存储在Documents中。获取其路径的方法如下：<br>//获取Document文件夹路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSArray*path=NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES);</div><div class="line">NSString *pathDocuments=[path objectAtIndex:0];</div></pre></td></tr></table></figure>

<p>可以看到，第一次获取的地址其实是一个数组，我们取出其中的第一项才是我们想要获取的路径。那么当然可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *pathDocuments=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];</div></pre></td></tr></table></figure>

<p>3.创建文件与将内容写入文件<br>我们之前获取的路径是目录的路径，所以我们需要手动为其补全为文件路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">NSString *createFileName=@"new.txt";//文件名</div><div class="line">NSString *createPath=[NSString stringWithFormat:@"%@/%@",pathDocuments,createFileName];//用文件名补全路径</div><div class="line">if ([[NSFileManager defaultManager] fileExistsAtPath:createPath])//判断文件是否已存在</div><div class="line">{</div><div class="line">NSLog(@"文件已存在！");</div><div class="line">}</div><div class="line">else</div><div class="line">{</div><div class="line">NSData *data = [@"这里是新文件的内容" dataUsingEncoding:NSUTF8StringEncoding];//新文件的初始数据</div><div class="line">[[NSFileManager defaultManager] createFileAtPath:createPath contents:data attributes:nil];//创建文件</div><div class="line">}</div></pre></td></tr></table></figure>

<p>多种对象类型都有直接写入文件的方法<br>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[userInfoDict writeToFile:filePath atomically:YES];</div></pre></td></tr></table></figure>

<p>4.删除文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSString *deletePath=[NSString stringWithFormat:@"%@/%@",pathDocuments,fileName];//补全文件名</div><div class="line">NSLog(@"%@",deletePath);</div><div class="line">NSError *error;</div><div class="line">[fileManager removeItemAtPath:deletePath error:&error];</div></pre></td></tr></table></figure>

<p>5.读取文件<br>多种类型的对象创建时都可以直接从文件获取数据，但是切记要用完整路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSArray *readArray=[NSArray arrayWithContentsOfFile:filePath];</div><div class="line">NSDictionary *readDict=[NSDictionary dictionaryWithContentsOfFile:filePath];</div><div class="line">UIImage *readImage=[UIImage imageWithContentsOfFile:filePath];</div></pre></td></tr></table></figure>

<p>6.获取文件信息<br>获取文件信息是fileManager的一个方法，信息包括文件的创建时间，修改时间，是否隐藏扩展名，以及文件大小等属性。<br>使用方法如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSFileManager *fileMng=[[NSFileManager alloc] init];</div><div class="line">NSDictionary *attrDict=[fileMng attributesOfItemAtPath:filePath error:NULL];</div></pre></td></tr></table></figure>

<p>文件信息保存在attrDict中</p>

      
    </div>
    <footer>
      
  
  <div class="categories">
    <a href="/categories/iOS应用开发之网络通讯/">iOS应用开发之网络通讯</a>
  </div>

      
  
  <div class="tags">
    <a href="/tags/存储/">存储</a>, <a href="/tags/ios/">ios</a>, <a href="/tags/iphone开发/">iphone开发</a>
  </div>

      
        
          <div class="alignright share-box">
  
</div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
      
        <div class="icon"></div>
        <time datetime="2013-08-29T00:38:00.000Z"><a href="/2013/08/29/服务器临时存储数据/">8月 29 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/08/29/服务器临时存储数据/">服务器临时存储数据</a></h1>
  

      
    </header>
    <div class="entry">
      
        
        <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//关键字class声明一个类  class相当于oc中的@interface</span></div><div class="line"><span class="comment">//类名 Uesr 当前看似没有继承关系 其实是继承自Object，凡是继承自Object的类，继承关系可以不写</span></div><div class="line"><span class="comment">//继承不是oc中的“：”而是extends</span></div><div class="line"><span class="comment">//java类的声明和实现在一个文件中，而且在类中无论什么地方都可以声明变量</span></div><div class="line"></div><div class="line"><span class="comment">//public 共有的 在所有类中可用</span></div><div class="line"><span class="comment">//private 私有的 只有在本类中可用</span></div><div class="line"><span class="comment">//protected 受保护的  在同一个包中可用，在子类中可用</span></div><div class="line">public class User1 {</div><div class="line"></div><div class="line"><span class="comment">//    属性一般声明为私有的</span></div><div class="line"><span class="comment">//    提供get set 方法类取值 赋值</span></div><div class="line">    private String name;</div><div class="line">    private String psw;</div><div class="line">    private String tname;</div><div class="line">    private String email;</div><div class="line"></div><div class="line"><span class="comment">//    int age;</span></div><div class="line"><span class="comment">//    boolean sex;</span></div><div class="line"><span class="comment">//    float height;</span></div><div class="line"></div><div class="line"><span class="comment">//    无参构造函数  构造函数没有返回值 函数名即类名</span></div><div class="line">    public User1() {</div><div class="line">    }</div><div class="line"></div><div class="line">    public User1(String name, String psw) {</div><div class="line">        <span class="keyword">this</span><span class="variable">.name</span> = name;</div><div class="line">        <span class="keyword">this</span><span class="variable">.psw</span> = psw;</div><div class="line">    }</div><div class="line"></div><div class="line">    public User1(String name, String psw, String tname, String email) {</div><div class="line">        <span class="keyword">this</span><span class="variable">.name</span> = name;</div><div class="line">        <span class="keyword">this</span><span class="variable">.psw</span> = psw;</div><div class="line">        <span class="keyword">this</span><span class="variable">.tname</span> = tname;</div><div class="line">        <span class="keyword">this</span><span class="variable">.email</span> = email;</div><div class="line">    }</div><div class="line"><span class="comment">//哈希表创建</span></div><div class="line">public class a extends HttpServlet {</div><div class="line">    </div><div class="line">    </div><div class="line">Hashtable hastable;</div><div class="line"></div><div class="line">    public a()</div><div class="line">    {</div><div class="line">        hastable = new Hashtable();</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="comment">//trim()去空格的</span></div><div class="line">        String command = request<span class="variable">.getParameter</span>(<span class="string">"command"</span>)<span class="variable">.trim</span>();</div><div class="line"><span class="comment">//数据类型转换</span></div><div class="line">Integer<span class="variable">.parseInt</span>(command)</div><div class="line"></div><div class="line"><span class="comment">//从哈希表中根据键值取出一个对象</span></div><div class="line">User aUser = (User) members<span class="variable">.get</span>(name);</div><div class="line"></div><div class="line"><span class="comment">//创建一个对象,向哈希表添加,以name为key user为values</span></div><div class="line">User user = new User(name,psw,truename,email);</div><div class="line">                    members<span class="variable">.put</span>(name, user);</div><div class="line">                   </div><div class="line"><span class="comment">// members.put(key, values)</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//比较字符串是否相同  .equals</span></div><div class="line">psw<span class="variable">.equals</span>(user<span class="variable">.getPsw</span>()</div><div class="line"></div><div class="line"><span class="comment">//获得哈希表所有的key</span></div><div class="line">Enumeration enumer = members<span class="variable">.keys</span>();</div><div class="line"></div><div class="line"><span class="comment">//一直运行到哈希表最后一个对象,运行keys的长度的次数</span></div><div class="line"><span class="keyword">while</span> (enumer<span class="variable">.hasMoreElements</span>())</div><div class="line">                    {</div><div class="line">            <span class="comment">//取出当前哈希表对象的key</span></div><div class="line">            String key = (String) enumer<span class="variable">.nextElement</span>();</div><div class="line">            <span class="comment">//xml方式回送数据,以自定义标签对的形式返回数据</span></div><div class="line">            </div><div class="line">                User tempUser = (User) members<span class="variable">.get</span>(key);</div><div class="line">    </div><div class="line">                                <span class="keyword">out</span><span class="variable">.println</span>(<span class="string">"&lt;user&gt;"</span>);</div><div class="line">                            <span class="keyword">out</span><span class="variable">.println</span>(<span class="string">"&lt;name&gt;"</span> + tempUser<span class="variable">.getName</span>() +<span class="string">"&lt;/name&gt;"</span>);</div><div class="line">                            <span class="keyword">out</span><span class="variable">.println</span>(<span class="string">"&lt;tname&gt;"</span> + tempUser<span class="variable">.getTruename</span>() +<span class="string">"&lt;/tname&gt;"</span>);</div><div class="line">                            <span class="keyword">out</span><span class="variable">.println</span>(<span class="string">"&lt;email&gt;"</span> + tempUser<span class="variable">.getEmail</span>() +<span class="string">"&lt;/email&gt;"</span>);</div><div class="line">                            <span class="keyword">out</span><span class="variable">.println</span>(<span class="string">"&lt;/user&gt;"</span>);</div><div class="line"></div><div class="line"></div><div class="line">        }</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
  
  <div class="categories">
    <a href="/categories/iOS应用开发之网络通讯/">iOS应用开发之网络通讯</a>
  </div>

      
      
        
          <div class="alignright share-box">
  
</div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
      
        <div class="icon"></div>
        <time datetime="2013-08-29T00:35:00.000Z"><a href="/2013/08/29/IOS之同步请求、异步请求、GET请求、POST请求/">8月 29 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/08/29/IOS之同步请求、异步请求、GET请求、POST请求/">IOS之同步请求、异步请求、GET请求、POST请求</a></h1>
  

      
    </header>
    <div class="entry">
      
        
        <p>1、同步请求可以从因特网请求数据，一旦发送同步请求，程序将停止用户交互，直至服务器返回数据完成，才可以进行下一步操作，<br>2、异步请求不会阻塞主线程，而会建立一个新的线程来操作，用户发出异步请求后，依然可以对UI进行操作，程序可以继续运行<br>3、GET请求，将参数直接写在访问路径上。操作简单，不过容易被外界看到，安全性不高，地址最多255字节；<br>4、POST请求，将参数放到body里面。POST请求操作相对复杂，需要将参数和地址分开，不过安全性高，参数放在body里面，不易被捕获。</p>
<p>1、同步GET请求<br>第一步，创建URL</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:@[http:<span class="comment">//api.hudong.com/iphonexml.do?type=focus-c](http://api.hudong.com/iphonexml.do?type=focus-c)];</span></div></pre></td></tr></table></figure>

<p>第二步，通过URL创建网络请求</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURLRequest</span> *request = [[<span class="built_in">NSURLRequest</span> alloc]initWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:<span class="number">10</span>];</div></pre></td></tr></table></figure>

<p>//NSURLRequest初始化方法第一个参数：请求访问路径，第二个参数：缓存协议，第三个参数：网络请求超时时间（秒）</p>
<p>其中缓存协议是个枚举类型包含：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSURLRequestUseProtocolCachePolicy（基础策略）</div><div class="line">NSURLRequestReloadIgnoringLocalCacheData（忽略本地缓存）</div><div class="line"> NSURLRequestReturnCacheDataElseLoad（首先使用缓存，如果没有本地缓存，才从原地址下载）</div><div class="line">NSURLRequestReturnCacheDataDontLoad（使用本地缓存，从不下载，如果本地没有缓存，则请求失败，此策略多用于离线操作）</div><div class="line">NSURLRequestReloadIgnoringLocalAndRemoteCacheData（无视任何缓存策略，无论是本地的还是远程的，总是从原地址重新下载）</div><div class="line">NSURLRequestReloadRevalidatingCacheData（如果本地缓存是有效的则不下载，其他任何情况都从原地址重新下载）</div></pre></td></tr></table></figure>

<p>第三步，连接服务器</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSData *received = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:<span class="literal">nil</span> error:<span class="literal">nil</span>];</div><div class="line"><span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc]initWithData:received encoding:NSUTF8StringEncoding];</div></pre></td></tr></table></figure>

<p>2、同步POST请求<br>第一步，创建URL</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:@[http:<span class="comment">//api.hudong.com/iphonexml.do](http://api.hudong.com/iphonexml.do)];</span></div></pre></td></tr></table></figure>

<p>第二步，创建请求</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSMutableURLRequest *request = [[NSMutableURLRequest alloc]initWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:<span class="number">10</span>];</div><div class="line"> [request setHTTPMethod:<span class="string">@"POST"</span>];<span class="comment">//设置请求方式为POST，默认为GET</span></div><div class="line"> <span class="built_in">NSString</span> *str = <span class="string">@"type=focus-c"</span>;<span class="comment">//设置参数</span></div><div class="line">NSData *data = [str dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"> [request setHTTPBody:data];</div></pre></td></tr></table></figure>

<p>第三步，连接服务器</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> NSData *received = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request returningResponse:<span class="literal">nil</span> error:<span class="literal">nil</span>];</div><div class="line"><span class="built_in">NSString</span> *str1 = [[<span class="built_in">NSString</span> alloc]initWithData:received encoding:NSUTF8StringEncoding];</div></pre></td></tr></table></figure>

<p>3、异步GET请求</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一步，创建url</span></div><div class="line">  <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://api.hudong.com/iphonexml.do?type=focus-c"</span>];</div><div class="line"><span class="comment">//第二步，创建请求</span></div><div class="line"><span class="built_in">NSURLRequest</span> *request = [[<span class="built_in">NSURLRequest</span> alloc]initWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:<span class="number">10</span>];</div><div class="line"><span class="comment">//第三步，连接服务器</span></div><div class="line"> <span class="built_in">NSURLConnection</span> *connection = [[<span class="built_in">NSURLConnection</span> alloc]initWithRequest:request delegate:<span class="keyword">self</span>];</div></pre></td></tr></table></figure>

<p>4、异步POST请求</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一步，创建url</span></div><div class="line"> <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://api.hudong.com/iphonexml.do"</span>];</div><div class="line"><span class="comment">//第二步，创建请求</span></div><div class="line">NSMutableURLRequest *request = [[NSMutableURLRequest alloc]initWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:<span class="number">10</span>];</div><div class="line">[request setHTTPMethod:<span class="string">@"POST"</span>];</div><div class="line"><span class="built_in">NSString</span> *str = <span class="string">@"type=focus-c"</span>;</div><div class="line">  NSData *data = [str dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">[request setHTTPBody:data];</div><div class="line"> </div><div class="line"><span class="comment">//第三步，连接服务器</span></div><div class="line"><span class="built_in">NSURLConnection</span> *connection = [[<span class="built_in">NSURLConnection</span> alloc]initWithRequest:request delegate:<span class="keyword">self</span>];</div></pre></td></tr></table></figure>

<p>5、异步请求的代理方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//接收到服务器回应的时候调用此方法</span></div><div class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(NSURLResponse *)response</div><div class="line">{</div><div class="line">     NSHTTPURLResponse *res = (NSHTTPURLResponse *)response;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[res allHeaderFields]);</div><div class="line">    <span class="keyword">self</span><span class="variable">.receiveData</span> = [NSMutableData data];</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//接收到服务器传输数据的时候调用，此方法根据数据大小执行若干次</span></div><div class="line">-(<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(NSData *)data</div><div class="line">{</div><div class="line">    [<span class="keyword">self</span><span class="variable">.receiveData</span> appendData:data];</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//数据传完之后调用此方法</span></div><div class="line">-(<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</div><div class="line">{</div><div class="line">    <span class="built_in">NSString</span> *receiveStr = [[<span class="built_in">NSString</span> alloc]initWithData:<span class="keyword">self</span><span class="variable">.receiveData</span> encoding:NSUTF8StringEncoding];</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,receiveStr);</div><div class="line">}</div></pre></td></tr></table></figure>



      
    </div>
    <footer>
      
  
  <div class="categories">
    <a href="/categories/iOS应用开发之网络通讯/">iOS应用开发之网络通讯</a>
  </div>

      
  
  <div class="tags">
    <a href="/tags/ios/">ios</a>
  </div>

      
        
          <div class="alignright share-box">
  
</div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/13/" class="alignleft prev">Prev</a>
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  
    <form>
      <input id="st-search-input" type="search" placeholder="Search">
    </form>
    <div id="st-results-container"></div>
  
</div>

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <div class="entry">
    
      <span><a href="/tags/2d/">2d<small>1</small></a></span>
    
      <span><a href="/tags/AFNetworking/">AFNetworking<small>2</small></a></span>
    
      <span><a href="/tags/CoreData/">CoreData<small>2</small></a></span>
    
      <span><a href="/tags/Drawing/">Drawing<small>1</small></a></span>
    
      <span><a href="/tags/MagicalRecord/">MagicalRecord<small>1</small></a></span>
    
      <span><a href="/tags/NSDate/">NSDate<small>1</small></a></span>
    
      <span><a href="/tags/NSString/">NSString<small>1</small></a></span>
    
      <span><a href="/tags/Swift/">Swift<small>9</small></a></span>
    
      <span><a href="/tags/UIAlertView/">UIAlertView<small>1</small></a></span>
    
      <span><a href="/tags/UITabBarController/">UITabBarController<small>1</small></a></span>
    
      <span><a href="/tags/UITableViewControlle/">UITableViewControlle<small>1</small></a></span>
    
      <span><a href="/tags/UIWebView/">UIWebView<small>1</small></a></span>
    
      <span><a href="/tags/URL-Scheme/">URL Scheme<small>1</small></a></span>
    
      <span><a href="/tags/URL编码/">URL编码<small>1</small></a></span>
    
      <span><a href="/tags/XMPP/">XMPP<small>3</small></a></span>
    
      <span><a href="/tags/Xcode5-1/">Xcode5.1<small>1</small></a></span>
    
      <span><a href="/tags/api/">api<small>5</small></a></span>
    
      <span><a href="/tags/appStore审核/">appStore审核<small>1</small></a></span>
    
      <span><a href="/tags/block/">block<small>1</small></a></span>
    
      <span><a href="/tags/bytearray/">bytearray<small>1</small></a></span>
    
      <span><a href="/tags/cell自适应高度/">cell自适应高度<small>1</small></a></span>
    
      <span><a href="/tags/cocos2d/">cocos2d<small>3</small></a></span>
    
      <span><a href="/tags/fontfontiPhone开发font/">fontfontiPhone开发font<small>1</small></a></span>
    
      <span><a href="/tags/fontfontiPhone开发fontfont/">fontfontiPhone开发fontfont<small>1</small></a></span>
    
      <span><a href="/tags/fontfontios的fontfont/">fontfontios的fontfont<small>2</small></a></span>
    
      <span><a href="/tags/fontfont动画fontfont/">fontfont动画fontfont<small>1</small></a></span>
    
      <span><a href="/tags/framework/">framework<small>1</small></a></span>
    
      <span><a href="/tags/iOS8/">iOS8<small>2</small></a></span>
    
      <span><a href="/tags/iOS8-1-1/">iOS8.1.1<small>1</small></a></span>
    
      <span><a href="/tags/iOS8定位/">iOS8定位<small>1</small></a></span>
    
      <span><a href="/tags/iOS国际化/">iOS国际化<small>1</small></a></span>
    
      <span><a href="/tags/iOS应用开发之app上架/">iOS应用开发之app上架<small>1</small></a></span>
    
      <span><a href="/tags/iOS应用开发之第三方框架/">iOS应用开发之第三方框架<small>1</small></a></span>
    
      <span><a href="/tags/iOS开发/">iOS开发<small>5</small></a></span>
    
      <span><a href="/tags/iOS自定义Tabbar/">iOS自定义Tabbar<small>1</small></a></span>
    
      <span><a href="/tags/ios/">ios<small>53</small></a></span>
    
      <span><a href="/tags/ios7/">ios7<small>1</small></a></span>
    
      <span><a href="/tags/ios7适配/">ios7适配<small>1</small></a></span>
    
      <span><a href="/tags/ios国际化/">ios国际化<small>1</small></a></span>
    
      <span><a href="/tags/ios开发/">ios开发<small>27</small></a></span>
    
      <span><a href="/tags/iphone/">iphone<small>4</small></a></span>
    
      <span><a href="/tags/iphone开发/">iphone开发<small>59</small></a></span>
    
      <span><a href="/tags/itunes/">itunes<small>1</small></a></span>
    
      <span><a href="/tags/objective-c/">objective-c<small>1</small></a></span>
    
      <span><a href="/tags/svn/">svn<small>1</small></a></span>
    
      <span><a href="/tags/uiimage/">uiimage<small>2</small></a></span>
    
      <span><a href="/tags/uitableview/">uitableview<small>1</small></a></span>
    
      <span><a href="/tags/uitableviewcell/">uitableviewcell<small>1</small></a></span>
    
      <span><a href="/tags/uitextfield/">uitextfield<small>1</small></a></span>
    
      <span><a href="/tags/uiview/">uiview<small>3</small></a></span>
    
      <span><a href="/tags/uiviewcontroller/">uiviewcontroller<small>1</small></a></span>
    
      <span><a href="/tags/uiwebview/">uiwebview<small>1</small></a></span>
    
      <span><a href="/tags/xcode/">xcode<small>2</small></a></span>
    
      <span><a href="/tags/xmpp/">xmpp<small>1</small></a></span>
    
      <span><a href="/tags/二维码/">二维码<small>1</small></a></span>
    
      <span><a href="/tags/企业/">企业<small>1</small></a></span>
    
      <span><a href="/tags/动画/">动画<small>5</small></a></span>
    
      <span><a href="/tags/国际化/">国际化<small>1</small></a></span>
    
      <span><a href="/tags/在线工具/">在线工具<small>1</small></a></span>
    
      <span><a href="/tags/多线程/">多线程<small>1</small></a></span>
    
      <span><a href="/tags/存储/">存储<small>1</small></a></span>
    
      <span><a href="/tags/宏/">宏<small>1</small></a></span>
    
      <span><a href="/tags/导航/">导航<small>1</small></a></span>
    
      <span><a href="/tags/屏幕旋转/">屏幕旋转<small>2</small></a></span>
    
      <span><a href="/tags/应用程序/">应用程序<small>2</small></a></span>
    
      <span><a href="/tags/微信开放平台ios/">微信开放平台ios<small>1</small></a></span>
    
      <span><a href="/tags/打开AppStore/">打开AppStore<small>1</small></a></span>
    
      <span><a href="/tags/数据库/">数据库<small>1</small></a></span>
    
      <span><a href="/tags/缓存/">缓存<small>1</small></a></span>
    
      <span><a href="/tags/聊天/">聊天<small>1</small></a></span>
    
      <span><a href="/tags/苹果应用商店/">苹果应用商店<small>1</small></a></span>
    
      <span><a href="/tags/获取iP地址/">获取iP地址<small>1</small></a></span>
    
  </div>
</div>




  <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

    _st('install','6xH6jcZvsZxn2a9rcU4t');
  </script>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div id="foot-nav">
  <ul class="social">
    
      <li><a class="github" href="https://github.com/DaiXiang" title="github">github</a></li>
    
      <li><a class="rss" href="/atom.xml" title="rss">rss</a></li>
    
  </ul>
</div>
<div>
  
    &copy; 2014 尹现伟
  
</div>
<div class="clearfix"></div></footer>
  


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<script type="text/javascript">
  function navbar() {
    var top = $('#nav-top').innerHeight();
    $('#header').css('min-height', top);
  }
  navbar();
  $(window).resize(navbar);
</script>
<div id="totop" class="footer-btn">
  <a title="Return to Top"><img src="/img/scrollup.png"/></a>
</div>

<script type="text/javascript">
  $(function(){ 
	// When to show the scroll link
	// higher number = scroll link appears further down the page   
	var upperLimit = 800;
	
	// Our scroll link element
	var scrollElem = $('#totop');
   
	// Scroll to top speed
	var scrollSpeed = 500;
   
	// Show and hide the scroll to top link based on scroll position   
	scrollElem.hide();
	$(window).scroll(function () {            
		var scrollTop = $(document).scrollTop();       
		if ( scrollTop > upperLimit ) {
		  $(scrollElem).stop().fadeTo(300, 1); // fade back in
		  $(scrollElem).animate({bottom: "50px"}, { queue: false, duration: 10 });
		} else {
		  $(scrollElem).stop().fadeTo(300, 0); // fade out
	      $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
			
		}
	});

	// Scroll to top animation on click
	$(scrollElem).click(function(){
	  $('html, body').animate({scrollTop:0}, scrollSpeed);
	  $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
	  return false;
	});
  });
</script>
</body>
</html>